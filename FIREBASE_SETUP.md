# Firebase Setup Guide for Abhoy Catering

## Step 1: Install Firebase CLI

1. Install Node.js if you haven't already: https://nodejs.org/
2. Install Firebase CLI:
```bash
npm install -g firebase-tools
```

3. Login to Firebase:
```bash
firebase login
```

## Step 2: Create Firebase Project

1. Go to https://console.firebase.google.com/
2. Click "Add project"
3. Enter project name: `abhoy-catering` (or your preferred name)
4. Disable Google Analytics (optional)
5. Click "Create project"

## Step 3: Enable Firestore Database

1. In Firebase Console, go to "Build" → "Firestore Database"
2. Click "Create database"
3. Choose "Start in test mode" (for development)
4. Select your region (choose closest to India, e.g., asia-south1)
5. Click "Enable"

## Step 4: Configure Firebase for Flutter

### Option A: Using FlutterFire CLI (Recommended - Easiest)

1. Install FlutterFire CLI:
```bash
dart pub global activate flutterfire_cli
```

2. Run FlutterFire configure in your project directory:
```bash
cd c:\flutter_work_dir\abhoy_catering
flutterfire configure
```

3. Select your Firebase project
4. Select platforms (Windows, Android, iOS, Web)
5. This will automatically create `firebase_options.dart` and configure all platforms

### Option B: Manual Configuration

If FlutterFire CLI doesn't work, follow these manual steps:

#### For Android:
1. In Firebase Console, click "Add app" → Android
2. Enter package name: `com.example.abhoy_catering` (check in `android/app/build.gradle`)
3. Download `google-services.json`
4. Place it in `android/app/` directory
5. Update `android/build.gradle`:
```gradle
buildscript {
    dependencies {
        classpath 'com.google.gms:google-services:4.4.0'
    }
}
```
6. Update `android/app/build.gradle`:
```gradle
apply plugin: 'com.google.gms.google-services'
```

#### For Web:
1. In Firebase Console, click "Add app" → Web
2. Register app name
3. Copy the Firebase config
4. Create `web/firebase-config.js` with the config

#### For Windows:
Windows uses the same configuration as Web through `firebase_options.dart`

## Step 5: Update main.dart

The main.dart file needs to be updated to initialize Firebase. Here's the code:

```dart
import 'package:flutter/material.dart';
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart'; // This will be generated by flutterfire configure
import 'package:provider/provider.dart';
import 'providers/locale_provider.dart';
import 'l10n/app_localizations.dart';
import 'screens/home_screen.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  
  // Initialize Firebase
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return ChangeNotifierProvider(
      create: (_) => LocaleProvider(),
      child: Consumer<LocaleProvider>(
        builder: (context, provider, child) {
          return MaterialApp(
            title: 'Abhay Catering',
            debugShowCheckedModeBanner: false,
            locale: provider.locale,
            localizationsDelegates: AppLocalizations.localizationsDelegates,
            supportedLocales: AppLocalizations.supportedLocales,
            theme: ThemeData(
              primarySwatch: Colors.orange,
              useMaterial3: true,
            ),
            home: const HomeScreen(),
          );
        },
      ),
    );
  }
}
```

## Step 6: Install Dependencies

Run this command in your project directory:
```bash
flutter pub get
```

## Step 7: Set up Firestore Security Rules

In Firebase Console → Firestore Database → Rules, use these rules for development:

```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Bookings collection
    match /bookings/{bookingId} {
      // Allow anyone to create bookings
      allow create: if true;
      
      // Allow reading own bookings by phone number
      allow read: if request.auth != null || 
                     resource.data.customerPhone == request.resource.data.customerPhone;
      
      // Allow updates only for authenticated users (admin)
      allow update, delete: if request.auth != null;
    }
  }
}
```

For production, use more restrictive rules:
```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /bookings/{bookingId} {
      allow create: if true;
      allow read: if request.auth != null;
      allow update, delete: if request.auth != null;
    }
  }
}
```

## Step 8: Test Firebase Connection

After setup, run your app:
```bash
flutter run -d windows
```

Or for web:
```bash
flutter run -d chrome
```

## Firestore Database Structure

Your bookings will be stored with this structure:

```
bookings (collection)
  └── {bookingId} (document)
      ├── id: string
      ├── eventType: string
      ├── serviceType: string
      ├── selectedMenuItems: map
      ├── guestCount: number
      ├── eventDate: timestamp
      ├── serviceTime: string
      ├── venueAddress: string
      ├── createdAt: timestamp
      ├── status: string (pending/confirmed/cancelled)
      ├── customerName: string (optional)
      ├── customerPhone: string (optional)
      └── customerEmail: string (optional)
```

## Usage in Your App

The Firebase service is already integrated. When a user completes booking:

1. They fill in event details
2. Select service type
3. Choose menu items
4. Enter logistics (date, venue, etc.)
5. Review and confirm
6. **Booking is automatically saved to Firebase Firestore**

You can view all bookings in Firebase Console → Firestore Database

## Troubleshooting

### Error: "No Firebase App '[DEFAULT]' has been created"
- Make sure `Firebase.initializeApp()` is called in `main()` before `runApp()`
- Ensure `firebase_options.dart` exists

### Error: "MissingPluginException"
- Run `flutter clean`
- Run `flutter pub get`
- Restart your IDE
- Run the app again

### Error: "google-services.json not found"
- Download the file from Firebase Console
- Place it in `android/app/` directory
- Make sure the filename is exactly `google-services.json`

### FlutterFire CLI not found
- Make sure Dart SDK is in your PATH
- Run: `dart pub global activate flutterfire_cli`
- Add Dart global bin to PATH: `%USERPROFILE%\AppData\Local\Pub\Cache\bin`

## Next Steps

1. Run `flutterfire configure` to set up Firebase
2. Update `main.dart` with Firebase initialization
3. Test the booking flow
4. View bookings in Firebase Console
5. Implement admin panel to manage bookings (optional)

## Admin Features (Future Enhancement)

You can build an admin panel to:
- View all bookings
- Update booking status (pending → confirmed)
- Filter bookings by date, status, service type
- Search bookings by customer phone/name
- Export booking data
- Send notifications to customers

All the Firebase service methods are already implemented in `lib/services/firebase_service.dart`!
